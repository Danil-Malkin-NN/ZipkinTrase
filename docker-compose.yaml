version: 2.29.2
services:
  firs:
    image: docker.io/library/service:0.0.3-KAFKA
    environment:
      PORT: 8081
      NAME: firs
      NEXT_SERVICE: http://second:8082
      ZIPKIN_URL: http://zipkin:9411
      KAFKA_URL: http://kafka:9092
      KAFKA_IN: void2
      KAFKA_OUT: zip_test_second
    ports:
      - 8081:8081
    depends_on:
      - second

  second:
    image: docker.io/library/service:0.0.3-KAFKA
    environment:
      PORT: 8082
      NAME: second
      NEXT_SERVICE: http://third:8083
      ZIPKIN_URL: http://zipkin:9411
      KAFKA_URL: http://kafka:9092
      KAFKA_IN: zip_test_second
      KAFKA_OUT: zip_test_third
    ports:
      - 8082:8082
    depends_on:
      - third

  third:
    image: docker.io/library/service:0.0.3-KAFKA
    environment:
      PORT: 8083
      NAME: third
      NEXT_SERVICE: false
      ZIPKIN_URL: http://zipkin:9411
      KAFKA_URL: http://kafka:9092
      KAFKA_IN: zip_test_third
      KAFKA_OUT: void
    ports:
      - 8083:8083
    depends_on:
      - zipkin

  zipkin:
    image: openzipkin/zipkin-slim
    ports:
      - 9411:9411

  zookeeper:
    image: wurstmeister/zookeeper
    container_name: zookeeper
    ports:
      - "2181:2181"

  kafka:
    image: wurstmeister/kafka
    container_name: kafka
    ports:
      - "9092:9092"
    environment:
      KAFKA_ADVERTISED_LISTENERS: INSIDE://kafka:9092,OUTSIDE://localhost:9093
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: INSIDE:PLAINTEXT,OUTSIDE:PLAINTEXT
      KAFKA_LISTENERS: INSIDE://0.0.0.0:9092,OUTSIDE://0.0.0.0:9093
      KAFKA_INTER_BROKER_LISTENER_NAME: INSIDE
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_CREATE_TOPICS: "baeldung:1:1"
